<style>
    .ui-datepicker-calendar {display: none;}
</style>
{{form_open('consumo/save/'~person_info.person_id,{'id':'consumo_form'})}}
<div id="required_fields_message">{{line('common_fields_required_message')}}</div>
<ul id="error_message_box"></ul>
<fieldset id="customer_basic_info">
    <legend>{{line("consumo_basic_information")}}</legend>
    <div class="field_row clearfix">	
        {{form_label(line('consumo_fecha')~':', 'fecha_consumo')}}
        <div class='form_field'>
            {{ form_input({'name':'fecha_consumo', 'id':'fecha_consumo', 'value':person_info.fecha_consumo,'class':'form-control date-picker'})}}
        </div>
    </div>
    <div class="field_row clearfix">	
        {{form_label(line('consumo_registro_medidor')~':', 'registro_medidor')}}
        <div class='form_field'>
            {{ form_input({'name':'registro_medidor', 'id':'registro_medidor', 'value':person_info.registro_medidor,'class':'form-control'})}}
        </div>
    </div>
    <div class="field_row clearfix">	
        {{form_label(line('consumo_medidor')~':', 'consumo_medidor')}}
        <div class='form_field'>

            {{ form_input({'name':'consumo_medidor', 'id':'consumo_medidor', 'value':person_info.consumo_medidor,'class':'form-control', 'readonly':true})}}

        </div>
    </div>
    <div class="field_row clearfix">	
        {{form_label(line('consumo_valor_a_pagar')~':', 'valor_a_pagar')}}
        <div class='form_field'>
            {{ form_input({'name':'valor_a_pagar', 'id':'valor_a_pagar', 'value':person_info.valor_a_pagar,'class':'form-control','readonly':true})}}
        </div>
    </div>
            
    <div class="field_row clearfix">	
        {{form_label(line('consumo_es_cambio_medidor')~':', 'es_cambio_medidor')}}
      {{ form_checkbox({'name':'es_cambio_medidor', 'id':'es_cambio_medidor', 'value':person_info.es_cambio_medidor,'class':'form-control'})}}
        </div>
    </div>
    
    <div class="field_row clearfix">	
        {{form_label(line('consumo_valor_cambio_medidor')~':', 'valor_cambio_medidor')}}
        <div class='form_field'>
            {{ form_input({'name':'valor_cambio_medidor', 'id':'valor_cambio_medidor', 'value':person_info.valor_cambio_medidor,'class':'form-control','readonly':true})}}
        </div>
    </div>

    {#<div class="field_row clearfix">	
        {{ form_label(line('customers_taxable')~':', 'taxable')}}
        <div class='form_field'>
            {{form_checkbox('taxable', '1', person_info.taxable == '' ? 'true' : person_info.taxable)}}
        </div>
    </div>#}
    <br>
    {{ form_submit({'name':'submit', 'id':'submit', 'value':line('common_submit'), 'class':'btn btn-success btn-block'})}}
</fieldset>
{{form_close()}}
{% block javascript %}
    <script type='text/javascript'>

        //validation and submit handling
        $(document).ready(function () {
            $('.date-picker').datepicker({
                changeMonth: true,
                changeYear: true,
                showButtonPanel: true,
                dateFormat: 'MM yy',
                onClose: function (dateText, inst) {
                    $(this).datepicker('setDate', new Date(inst.selectedYear, inst.selectedMonth, 1));
                }
            });
            $('#customer_form').validate({
                submitHandler: function (form) {
                    $.ajax({
                        type: $(form).attr('method'),
                        url: $(form).attr('action'),
                        data: $(form).serialize(),
                        success: function (response)
                        {
                            tb_remove();
                            post_person_form_submit(response);
                            console.log(response);
                        },
                        dataType: 'json'
                    });



                    /*$('#customer_form').submit(function (event) {
                     $.ajax({
                     type: 'POST',
                     url:  $('#customer_form').attr( "action" ),
                     data:  $( this ).serialize(), 
                     dataType: 'json', 
                     encode: true
                     })
                     .done(function (data) {
                     tb_remove();
                     post_person_form_submit(data);
                     console.log(data);
                     
                     });
                     });*/

                },
                errorLabelContainer: "#error_message_box",
                wrapper: "li",
                rules:
                        {
                            first_name: "required",
                            last_name: "required",
                            email: "email"
                        },
                messages:
                        {
                            first_name: "{{line('common_first_name_required')}}",
                            last_name: "{{line('common_last_name_required')}}",
                            email: "{{line('common_email_invalid_format')}}"
                        }
            });
        });
    </script>
{% endblock %}